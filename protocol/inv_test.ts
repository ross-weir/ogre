import { bytesToHex, hexToBytes } from "../_utils/hex.ts";
import { ScorexReader, ScorexWriter } from "../io/scorex_buffer.ts";
import { assertEquals, assertThrows } from "../test_deps.ts";
import { InvPayload, ObjectTypeId } from "./inv.ts";

Deno.test("[protocol/inv] InvPayload encoding roundtrip", async (t) => {
  const hex =
    "659003e7553c9a716bb3983ac8b0c21689a1f37ccdcde648a5be7677d673dae0d129f5bc0da4756528593b1c0a8365cd19a6cadb30a6f487a49cf9af722671cc4825c38eba8f05b0ce71797dc919ed80653e8be42186cbb6612320e3d35dedaad08ce7236e0056c80d9386b8f40f6ca61da923bd06cd8b48693eb0e89530088d24e8cb95e27a10c2092fa8488cd89db2e692631b8221600f406900c3f8918bd56b1851f5203d56462ee062b86af307dd127ecf554df700d87a9f65035b7b489397e05528d82d2748db59eb886c14d0259f455c8f3ef0abbfe4a3f9d107761de8b63760e78210b1d18c5a14b9aa96f1e28062144a46a1b8da85452d323d4a108ceabf9b8b3060ca3be1687588430e71b2405633cf5f4379ff061fdd631a7aeca7525ed9072f75ad25d67a1a3ac4bcf35557a5004c0fd8c8b5245c32357a521124d366f9a064522e188eda78f4452bf9fafd2103e6287754382ade6190d618526e253736202466766b68ea758f046542138e91d9a26194d933ce3d247c44c5a464964adbe4a145cf8dad8c9f293ccd5f7c836feb38550226595e9330a8dc546e1d3b84e965b9eec3c4c99ca1aef758503b8762db75d01d6bdee8e5178845df9f28760991a9378f28a6a6bfa4b221f781f384dc6955ed963dcd443072537eea65733990d505c2078f7f995908952f3e17458bd3b8619412d01115fd709adf37429216a9c1fae1899a1ba0ce2087e570662279e96bb45246b6880a7bd5c77714541323d7f86a10421bb7eb9f57c03da551571adad4ef587428e997ea5e1f6e5d518877656b3f8e16c915939a64e7d5947610307966921c47730bc78c2d567a36c7c0ddfb8453c66261cda6f221452b554e5d60d00bfaca4530cf61ed28cc2722195deff2e803d6da6e3eda00b75b13cb8c3245df163ce0119c8515c0b40939a9c1d10e39e5b4cb99b0d0af4465c59642cc30f4320236c54a5f27eedd89c074dc9d1bc74869da12ce433fe2933662a280a929bbc06002d6f84ce461ab2a9be373467e1f59892418b0ba7bcf77ec968e69561f6fe649fb5e87ed4ae79d201cadc688198ecf0cadb8cf13efc1610e32f4d6b8b0667169a7648a60dda566011240a7e9a5c8c598a0e5d3288376ffd7705394a94e8cd93a01ffb3b864bea159d464df082c808c6f5620d63037302ad709a0c67ed6462fccd0a27bae23496c952b68e3ec5a2c72006ffe6b9d7ed2629d67ad19555db37e7437317c47da930d50aa4d40a2ef2f2a84eff0730553d23a79bdb805fbaf2abdc8cca025efb61ae471f81a83e969898a850f4729971190839c788517380201ce7da7819c964a4cc18ce933ebdd3314409cfed2a21b75f2dcda527e23f7c99400de3537a1b9b0c7354074e1f43a32fff79c12c4a2e8733123a204bb5d6a28886d71a624338edffef94bca22ce12db1169978c4a19ce2c84b09436893a227155cf752c0c095ebb4650a5f305bbc66aa44519ef6d983081dfe5b9f941f6d38c956de253fab9247592f59854e4c22687c9c587e4fdfb9689582aa1d67b183ad5fe4e4e5685c3a84cc5d28c65d4fd1e029e425103bd8eda9770d2dd395afbc1e773c2f9ad45880ca34eaaaa61d7071239e3fbcd2c16308632f65cb4c413f65b25e6b776bf74ba45ba7ab142553480f352407d23754d2ad88828aeb57093c741299d6c494a8b2b2f39adb5035e0e6e89b96ce0762ec7f9608f1984319b1cc6548ce3812870706f1fbc2e35027b9ba57ff3f2c6f12f22df920e9d5870255515d68d133808facfe6cab00c7a4ea0780bf6662e1406e0676ddb82e3dfee541c6d68a99a263295e2f43507dfb94c4a64a6117d68c54918a28ac48b50afbf79e0bb9248532d17b7202bec3af7e59b007dfe050abd3aafb9b0a8bab024280f723ff71c7f18b766df8dc4c8defca886f7856fc64bc06b2f2a5ba3a9160dd6dcd55cb9208137572969774030b10e954cfae4be52514d2bd88705d4090ab8c65a02433cf2e91cd6c1566e3677b5c09c552938506963cbd0679026b7cb03858b0a6541dd01ae8ef03cfc38130d46930f4d9b53d62953e0b358300ff38d99668e1bfa05b8886fef176bc011ca82e93286590af0399732b9fd9b5e31204d101cddb711081102e7ee6acf3e55b8c4f78d3bb71cdc69be64fd613477df45f950f06f42a0496817319a04f9ec9489de1f69b234fb9169a2b2f87b7ba669fd84667e25713ccb79a9cdb6838067164a3f5e0d897c01e5cdd47ca51026ea91827f5b9ee1f832a12fa346c12dc5cec5e252d46f921afe29344b4d61aa6567583461cb1ac615fb2f471534ed623f0c94e2b2bf3c7479f4a7b4eb8f0047c933237fbfa2349f1a299b26030987a90c1ea1356ac521a8d4d1ec5e5c00ecbcffd7a505eee6c505844b43e1499da29390170db3b895a1df14a17da7a30c9572ae56536a9867cb6029be35e12eefe9f2ed8c0c160d296bf876218b4ac3148028c6f9296497a21fde38608eb2ada4d322f6e4c22084cc0b1bea64450324fc7856f43e1f8eddf058a4f14da70c9e9e38b9171e5d1b3e60fafcba9d0616f0458fdd03175abf2abf96446efe72f2a676213d1cdd18cbe342b32c903e8565902f3b3c460bb2cba0aab19b5e601daa3661521e8c4ff72df89c1a6d048cdec6eb26eea2b42122c790cf69edd4ee0143f5c1b782cda1d9455e2549df5acdb10ba813b2e8e483d88eee7b37624c7f29a016da7c1f371c5c21d0dd5d0694c3c283120d9095b84579d6905988f905d66ec822d5cf50b991e89624a26b1113cc63a9002d59a03e07b9f1ff27d91a1aac81479cbf34e8b66b71f14d410546b8784ad272b689c1338cccc8251baf6c09c26838ea13776174acf4c310b18e1c0096c4dc2c4f3de7967241fbe83a23f3a5def4221303a93e40dc36ae1feed5650b06f94c2d5a1c039cef3e8bf4244d999e0e15874a4e5c2949cc99afbeb380deb1dfda16ce3713f4cbb60fea4ff116d3b15a65ada51834db6bc6a746a04689c4cc701a6c2df895d38312380b7e2ccda088515654dc614f7e0311fe52d998639c9ec715478265ac6847bc5ad3b152679af6a48cd2d27abcee33d0cfb6d6632806f5aa9eddaad4f0c12d80ab03a5dbbdeafd4cbc94dc4375911b1323ec30b84518f608173ca91d9ae8a8617a7ab155ece2dd138e21167a0ce3e6f2eaf69572a03c83fee224fe5afba432be75340fe2bda5f48af1c63c1d9e40cf390d33c8b0caaf094a63be7812e7883e71db0c9c7c75f7a478ea908191b53d5d1f5c8128998fa37bfc3748662f5547128bc10c32bb482a41d8790d223b62280cbb157158158687c170a569cb42d82f30670f093e29920bbec1c0a10d2eb611cbfcd6fc67726ef58111723c2cbd73e14716de80c6990ec460c2c8d53c6afe0b1c4c7fef323c827765a11c9201b75f7832f2e2b10d4031d3f9d875fcd426346d61cd2364d54fc49d443b6eff17713920b2c488c018b2c8767e9cfa180ed1ac08abd42a253a6bcd808762b4c5d1fe49da65610f423430d520c1584f89668da061e3026761bc7e37459344e45cbcd53562e94232b6909f5f5807f2e7704eba8058abd3b2bb502d7e327e7a2da7bea0cc8eb05ee47476ad0fcbd119bf3c0621cba5c123324900eb38e95ec51c3b915f59e5f91fb3d01bf23952d7d4ca3210ab36d679e45b37ef8d2f79d67f6ec75d96012a73dc5fe1ce25843e050828d35e0e4a6ce704f2b3b7313d4dd388a83bcdde6df89af4ed546bfc70f8ae5188f2e4796f19f360e51ea892b362ce6d1b35611a17c2b61de188be7371d6ae547327f052e5eb8ab97c401599c0aede106350ccbddaaf9788caa539176ee8d84161d8cf30244d3fe5915ddba9f6807ce9f3340f2dc51c1ea982bd6de9041f9e78e1b24b8b46af4fab7312c492eb558de24a5423ba9bc415d4fb75a53fe7ff03eeb3c46fca16c313d3a137e1e56d7c61d0e14dac06b1b5a8cddb207fdbc98c42bb78217c78f63fee83aa6f84b3e5a34f4d380457b104619b25b051601d18090a16a442e37fe9679d5bd168f1f7a7406b79c24737199c5e3e07d3bdf9b7533242c5de459cae496836e529fd1fdaca632b555ba31f6c71b5a6022da8014f837be66ea8943d92358d7ad6e3f993c45dfd7cc42b17748baf2ede2593089b37000fe3f4a06a3081663fa5a5b658a828f75083536cd879c81927c6cfe233e8d24273b52e4a1add77919507ed9b1ca4b5f366e788e46bad892305e7959e6b3c487655911caf2179c3f77bbf27009048694499d37799205d76fd9df12c5cc9ccb2d5fca6e66a4326ead23019085a0a04a7327872ccfded9912301ec732923f6ee116d6252569d99fbbcda5f3254b814e656a33b6c7d97006f492f15b8bed24fb385013a5e238ea1df99f5db2bce1b751171fc16b9c54e26ec6f7cd3d8437de13afb2192eb7c486266a5afa832c50f7afd8df7370cb99f81036a315397f2a985407d5e33d15bf04eeebe2c5d62e58f367d850b73bb0441c19d7e7e425aba1f3048297ceac31825ce4a543c2e175126a374207d1c8272542a7700ba9196cfdac5566e8f246dc274025117941e4e9f03d6656a75bf1435c31935e8772de3f732b1a16bd8801a8504e0779ab1074f4c74eb0df484589671bc7495e4b1fc8a7f372a39940ac38d46ce53626bca32dbee3acee45454377fda125fcffdf0d649d923eeed3c02a53cbaae3a7e04036252a7ec42a95527f70416619f491db73b4be18d65524560dd91d0099474291cc0d3c8c651166de7803cc57836d715afb9a845769c03a1780a44314541c611a38e6231cbc3b7e95592efb4aee5d2c6a80a75a4b2f337c34df1861949a940de3757e209cb2cc1a295f3ab0b09d44980d1ae49511135f298559022bef994cbfca99b0b7c442631a45ce550eb5803ff0611abcecedf1f9915d88c24ce1c01e94301d2fd08dd02e6472d94dbc73ca48c37dbcb1b5fbe9cf2be690b5d76cf5b2eb03bf3e51c17135419944ebf3cac2cfa08f4820020fd7343a58b6f27755b704eb1e0381b78d7b2fee20831a1ed96a0403946d0bfb218d5da6f8ccfa7f42c266a553460667cd57d1e4fb9960f344b3f8ee575779b0a8abc0aa7d15396c755795f1dfded4b152ccb42bfe2afbe1416304bb023b11ada6fbea006ff8ac05c59d00d77a4ee091be376b2fdfc88738f854d0bb65432b055bf5f3a85f11cbf235a4bbcfcae27195e3671e4aaece87ab7bdef6d31fab57e07d5ae164b25bd1a10a4ff7891a2258b2fad63482b43cff1489ebae5ad08a2112f5f6b1294ebf031064d83af13b7bedcef972e32f814da17b955ec6c9a4f4b7bb18c6d1d200b5cd068dffed245decea10338bd422a4b4b69abaa398fe14ababd6466d4b145b42851d18624de69106d1f2f4de819b5516086eadd4583b17a5fa235c153cff7de1361035aac06cea3b0a8bc62606da94fba9d93ab490a5742884f14b53d16110615d7ced65076e809031da3acac977bba3c306e61ffed6627c9fd84780ca60b74309d7161656c0e0cf097f453385f6b10d96d5aea504f9bb0f992c7ddbaba618907fb065754a6ff788dd30b5921d1184de78a3e5cd4010e071e1c1a0100b0494dd30d67fa3fc500f1d3e0f120cd0b2e88646283a837c6dfd8897d83dcbc0e477172c05b447c01e79be61f5c80d0c953338fdfd51b0afb31fda106c00ec3c49fa1814fe162eb6d9b468e079db0144a8d3f2e2ca98e837222aa1d21b6357584863124a0ed053ae8d5bc32e66c0ad23ca4cdd7d703234bc3c1765536b97aa1ac7a5158ed05acf602bdf474f547ae08d01e35f88139661ddd3e75186fc598ea594366dda691b0777f477d056e6776d4fd183c66f846e4d872de1e011e1adf2f92e225cd9e9b9237d11ac1b28f04fd85af3cd2917413a5283ef816bf1bcda7bf7e6816c108074c802d5a5cf044686b2fbff75c7e28d0428a13a17509784ce0e19ba6adbfa664748aecdf5a4a80d738e37b3e0ce684cbec06c6089c88aa3257050e0907305059c25fa3f9b2ee852acaf0f860074e0da065b776009fb593340dfa614d22c31bbdde188087a88c51ea22765e8e256c277327f2c04a1d60e3e3b7be2190da8ad5e65680566538db7feaf36381cc9361bef33b5a60f332141366f2773aad5d32259623b5fc6d2e71731d2d5e1dceb1b0ba2d51ea71338d0b930aeff5aa3aa090ed2b2a37164aff72a52dfda8d92a74b332c911e0f4ccffb852e6fa415102680f4a272b34445f9894ae1697acf66c00345b2a4cab2cdd212972552e5f8e3677ef9f045d2efd7ba1f60382b19afc9923a2d5702cf351b6c9080ef02fbd9447719068d1dc76b757e6da72fc7adbe3c51d7c671a29f5e1c84c2ac45b12c8d2382da73bf7c28107c78ada1c05866d9b09e4ba293c015d9852533f24a0cf1dbd2e5873d5c317bc6236649b9c5805f930de3db8dfde505227051c484d22b4ece55ce96f8cab5c54557f80d0488a0a5ae468ae0aca8bdd3f23a7868530e1fc331dd982cd829365f19b3900c90d01dc116924c8a75a9f98344b865e78d7a5dab8b5e616d4616bd1325b1d98b8d2f727ea05c973c6e7f5950506bbc5f79915ff2bee4edad8ed9428cb6cfbc69ad6c36bf3703f303ab5d2827298c865d5304bb8e13b86e336b331abf3e235f32bf5e9d9b44a45b93f86742d936539c12cf1b7e3a2ca0d1b072ae6e0e382c3ab382106b179184738746090dd5c232437cc1626b3558184e41624630e6d86ea11135ed5f94f7ccf77c624f1bd2b38dcbdd3e21b69dad41511291c27aee603ee22ddb83b85030e861be0ceb2a96820ddc02f1a0bfd71cd1e352a6567a65305ed83ee33938aa315a9823bcabd0aea838dda48cf908f063d75dd69e265697cd6de97fbf615a2622097a89940bd9975a3de6532e9ececd916218cc2b878792a721eb5675f432da9f8cdb32bb3115d7f28824bc5c12656ddd2203e183515f8eb46c275935345b3345246ef2739a5ff41c01986fb325e90b396a38711c446ba94df74737386dc33616d29f68a3736295db44278e71259a71d71f10506d642bd9d7c84aac4eb65f146125c34da76b090a5b42e05a6bf19d5596095741544f46e78fcc3ddafaf8249fec6a59ef524b04309b9da8a69880483a659ce6d38d3e5e522355313574db144e4cb46a3895c2ea0ba07af21f71fbeecdada8dd1cf4a5a427064073e40f4b633a8c7f0b2b86a428628689251363ebfe5d8cad7faf903d88e2febd145e853f14098d2321e3322167017c5fada5989844e9efa9ebeeeccdc0e25c26b45cc2df6aa3b450ed13e8b6c48c75a6bfa61d8bd3c98e4e7ff6ca566561650fd9612f136b428bbb00e104b266d49b0c630fe27328eaca0e7139e8ed21d496d5682b33c186f8d5a78563add5595922c1f442d28de65575c64aa2eadcb33aebbef92434da63b3cd34add72fa56cfd3df452b958f4249482fc5503c9caefa653d55db57dd394c204e72aaf3572ee488c93bff3c6a72bf5826cc8290470cc95ed4b27a6cc415a2c1f34998224f738e78d7576be10246fd7b845325da2c10069d8a66bc370929702bbb9ef2d7c0d8c45dbaf48015735ca63d7e71037fde03ff18d3e70a5ea5f714edabae31e3128da59924af8a32f7539ced11f439b32890aca1bf5aeff5b8878e9e4b344b4d563a2c78052cfd508261ace8e2f44eb4259a8c85d0a91374afbaa99531832afc8fe2c3b0d4be6d500b589fa06043448603606a21729e5a88c54a9040bed5406205a8856c8029d7df5858fe7de9735a33a42a5af6e620676c6c644d9f09f3ccc83018a819ed89deab9a2a53861c2b473434dfdd1d0183fee938406b79f684354d924f41968db38735b386d020f1d56e14bd9012c30a9eeafd82c085a4e2ea0c4810b58f600a8fe2f6684cdf6161c10a85689b63f879921fdc96c7fddb7ac6eceee1a9a65e8d30e56c4011c98c7564987c57dae10eb257cd4a8b6eb37fe683150c97eb52dc508097eff2f90247fc3de2905fda2ce28c1410746ddffca482ed8b99154d19f7a80cc6ac11977ea72d268ffbf4684a6a4d9f10f70b2a7c10b16c409d9514ce5ff14f667b667d0ac71aab3ea2cbc0652ab5f1f170adcc2b68ee278a67bbde0384e88951ed03d230415f2b02ee95ee16bc4414926bf08138afe29d0880d24211eb8f1eefd3ff3f770db965fae70d68ede51be5131748e8bde8179db50d541e135e82079b0636ccf5f902382869c8d4b0897ab752a89069dc7f5f71b9e11d0c80fd595f61294a407edee929ca711e990e2f81c94dcb64e96b9f7fefdaa60de502173465b34ecf7ff1914b6fe9810bc6f80c5a798d4e25c25efbfab2c7b278aa24fa02dfc1d190d9e0d13f8c37ba65afa2cccdd5c59220792f404a12d20e5d355010ff4d40fe7d99c49f44990fd10f6f1c41d5c582ecb6f5e5d833e936c43633c91ceccc24097bbac4b0405c4c102e3e50b52eef8b586e2caa4cae1609327dd8cecfa302fdac9cd36d9c5fb7e14721beeef90eaa11fab1c34bb82a39bdc435093917b0529dd1dee52228792e516072a62eda8ea764b12e32890d527dbc69f9e7259677b475b4333abe542025755305cba5c1d41a1e6e6fc9a09521c9928c00984bf4c8a73b9c3263394538c98e668e7c9a16278173c0c37db15b43252f2ca5817149bde345fa4e05a7837b6bf4b1a16560d54d86a08bf2f7d93744ad5b9668795027c596fe3a8ec2407c89b300fd140767a40054d6112184efb215b147e503657a231efaae4a069f3cb033f090a7495bd0aadc15ab8c0e0a32c3f3d83c12c9c3c9b401d5f36c8c9de60af98db31ecd314d839ca2d06159e62fa9f5f113cc337220e050fb3050c1f97bd041d95edfaf28d136e6fcc14eb116da0e570d389ef22100ecab1d0dd7d02c7f303b8820c086fe6883e8edce2e07a30e696ba4d8e2cdd77371984de22139e92015c01ff43b9e203f42b89d8102e6a944998f2c66eb3c572748246347b78cf150abfade6591268ba2598e8f78dcea8e55511d609a5959e8027b0daffcfec57c52e1142d9e57b80ae7b0ac8e1e0140b95f237c38ae0c8ee9238b7473ceac68e04bb2cba37e07f45d6a17e1a20f5d1c7639228cf8d810003298de73e520c4db3d2a4b14d2e1c6ac95d2bb9ece73df76d94bd6c0d5f69047c4072ad6ebfdb72860eea173c3f1bfd6ad89bc03d47d40f33d4b0e6e0b255969ce8d132ce27d3cbf1b6ddef94c914e62b7e5d705c19f906d0b1b7a46a6aece33404de7ebdc23f8004f5a1f41cb5c13ed118779c0dd144f760f832b3ae13be993902d148fa7827d646830f088e38764658f7c61407d5590b34fed4dcd65524dfa3cac8649165ba72698789322a0b34658f9850f4f3a20a4e0dd397b64cb9803109d0486a71dc982e2a10702d2a448d1b7b39f392d4fed9f11bc73bfe220ef02ba4d0135f4ef52855adcbf6c3cd1d15aaeb170831386a069437dfe56d49d99df4d473d3d02c51c3ac278b81f018211051c859b115a2ada839e157febfa7247039599b145bbc6f2cc9290a5a0ac9199af9675d7789d18d25d103e166be14f8679874065fc1a8753f8011bfe6e6d78d1e8ae9c751331551b29a5dddd3520d29eff467258df7d087df565ed245249ef34b4fe3c2c3255beee8fda5aec7f8037cab3b69a100a65430cfbfb13a48330509dc9817b1ac8f555918b5817f8d5cf48dae2698750bcf2044892ad782cec464cae9b89f7fa1b6bee8a38331ea3adfe4d698314a35eed6959668a1fe078c643cde1e26fc6c0d65eadb1319ab637d236a30f85ef3c28808a14e24edb16ccf0284f40ab36846def72eb48a704bf99359ba2c826a93e46a9fb7bec4c7135a02c88af7ee77a621d99af29e5d24232f991e2349939b2da7856d47be8f272aed502e1ccab6a3f686116b0e4cc5263f80fb0ed293501d3c9d02176666690b7cf9bffef0693e70f13f895e807b52cdb3a0e5a599e1d7d34caf25e93b94c0a57a3be293af403da7a8af37b9c5f28a17b91fe3e73e841635bcf44fd65fa652e4636362c608a0fb45e81814544059cceba0958af787387507a88adce81e867f2594b7ce42b091fc1238144dd63754c9d1a2809662ec7632626e6f8b23a070c5aad46ecd76206179bb3ee874bab71ecbd5100060f28cd849df3f4884bb3891ba2b16f615937d376b5fcc799029f3924ebca6f679ce834da5dd56620b47b2dac91c2123004d2c395facc28641db4979020cfbff35dfa37a427de168ab7be5b79ca3bb17456cf81a9b6734a70b8ba21740106652d19398abdd5dfb10d084d59be19703671168b1874f0db07b4d1584b322cf16e54f886ba96e935ce888cb1e59a40c7b3343999689d7d892ff7ae3f46d259356fcdfe5e8a481ae1b73648b53f3eed5fe9a4da9340566da9c849823cdb3a6a9c165fe3632b729663638097f4532a27effcf0a05c90fae02992d2d7c8e5458ff16eba6aedd18c597602f60bf32c7053262c55a53efeff6fbd81fc4d1db8c6596401c35dd0c11b1f5284085e45a5e30af773fb7c699a07a21ebd7a85c9a9af9efa0fe6e94f21e932f8002430158912a9ac7b7c449fd2716b4f4c39d40bfac1904fc649391d34a443efdd594f57fc682fa43c1505403a775860948732549379cdf48d8ade428c14cb624bbdd117df783aaac0a54564208dd42df95b56f41211c23af57cd7eaafc15b7e07ca6cd4ad088da4b61ac380428ecd10954a1805a4ccf062a7d0d17406a67242d0428e5ea87716236c8691a20a82f5f004656c9cc2cc026c7d195ea3eb5c3029a10906d2c55f1232fea0babc0a7fde66b7f8375f00aa6f9511fec5164db991c015216099ce9dc16d5a431e4279a7aba5a39adc4d51c26e1563a84f2159dd675542c827f84aeb7680edf4ed472fd52863b51f9c2bad5cc2d9bc64efd79799492ae124ad900eb34646c4d5f87f5c54731fb8f2d72dca70adbac14c953a1c56b3ac374709c75bf9769387c8514bfc37270706a9788bc7035f4bdd3cebfc5de2c0de8fb6473f8455787b0f8cb414dfd34ef118791a574fa5073672c8ad0aa567d0e66940331e17308cc9fbb6790fa3940efb52c41b43c4f441c6bee63d7826650864b28985557cca28c3b16df66ccd694756b2a2785f8df6ee1dc04ca56bfe0aea3f21615774d1d74816df96b40c3b8c17da495a434b78466c100e1fac2145faf3b0b955da10c8279c52c4acfb48b009ebdbf1a0b02a9f7b9c50454fe1da2ba9a83f2d7ec8711362712ed808409e88b458b0f4a073f272e09d3a67e5cfe8d41bad638ca7263fc61c7b12ad03578dd2353609eb2a4065930d8fc71a13deee33ee1774e05e44ecc7dc8b00a8eccfb74e2fb924d879305162632d3679833bf0ba174f42cbab09ad4343c54679ba3e57e8237b59df2f02d79ddb2c6a661b12837a26824d38e4856ae9c6f18e353da0a93c5164c1dd6db4c722fc0f47bc784a471db20614ec3dcd00893ab1fffbf1a1d6809bf813b85a8a607ca2599520f060e92f6fa38fbd5d2e23b80404b3f6ee05c78a395acc849ae0348dbf1135d7662e23dd6a1dfa6ed3e882b43650e7c1a6295a245ecbf43485a7f36020c54664aac7aaeea916d1aa9993e3bb6287d8e9dda894a53df8b7f7d0403e3b7aa4cb133b38dbf9608401647ae203913d03acceee87a4e2976dd1f5030a5fccbfc32170a8075333c290216d3b760569ee38b2a208cb554aa8c3a342a7a8c2331f5da8162566c8eb20626f997b88cc378d1476be6ea6e5a5994bae130fb739b489d89a51fa3a019e1ddd7b6b9d60fb416cf0a2276220ef305b66b3c4fcf30aee1bcdfaa7cfc3e53409604aa96df99c09ae87443ad046e180ef0dee4c3f76777ebe8102d4b2016d6fe5ca67a09f5d535e371998a933a58793cda3f0835db33bd46bc75c469f7e27ed0dcd70f33dc6a45a5147efa00c2e4b691f1509f60e19e3822ef38199aa77a102266966b47d1f4e0712f26ef773247f4ed678861ac067baffc9ed9c0ddd49e81cde86d96323b7ccbd32276e67570cf9f8950e9c75eb0392812bece3a9e3d2b7495e4dabc07e2a27e74183a2e118c1d260f0ce1cea5c1eccaaa71711acd9f4d360cf1ea6ed70c7549f251de38624040161e1c31f1ff5b075a5ed3625a28371727403e3a31fc830514c77684ad03f3f7dba96a1a89cf84d2e27983caa8f750cc87db2dbcc74ae339018fa12a588b5cd952648966688cd072ec456c1a8775398947f945d21544568cf727519f0e2008f0199d907169c8a598252cc2f433e379bdefca195db3657a41402a3b689fe513b0880afc92087f24b704056a4a26ec5c4893a55e0e8a52256444656902e4dd85d68c086be6c24f01309df83f62896ac358e400264454ab1a23136a1b2330e1160d15b9d96aabe56eb6fc6daf5767e3a2592e6110ee764008e9a9fbf9aaff56490f9078f8cd5a2b93b1753b9e85e4fa79182644277adebe71669833e4551275b3b7a2e9bb8797679df142cfa3ddb34a58a9729903602e359852031e39ecc7f116b27070f38400b34737d9a0183d485cf1005d2841dccd82a77cd3b3e15af7d2281689ea914354a2b582b90fce2cd9fd73aac24820a539f51de4b6d28ff05a8ccdb27d79a5895e4f7fc3ece1ad824934f04793fc62e9a99350cf8cc68976486ef9082f2ccb1f3fdd290be0031aaa8bbd10207234912b0a9ea256ee950a26a4dfcd7b74fd04727489575e800876a3af8627e3c6d76f185ac53ac34c159cd5f62be65e54c86a6856ad63a596a671d7ffc40de7f8f0eac299e52968d39f13a966684f27279097cb9ff5c1d928ba5c7f3e3f048976f1bd5c02b61aca3bad2fa82c2ae9ae1c5e6d3a52e0c943e3eb4367f7f0ae7c42d99b7671464d163b340512810beeaa184f52cf96fa6e5c0a83e982d0249f9dd4de87cab9a4ca1097ccc0ecdeb1a23007ac524783fdea511bb2478f643bbe0f3eb7bc1a1f52717fadc89cc69bef56ae3cd629d4b05e96ef79057aea7693f259f23ea84884313aa04573c68949ced6a865d117d62e40bc0b3b1a14ec494dfdace716b2a4737b1810a02cfe9491a66124f2513291db5525573d0e4a3a95f7b42a02bac93389d29d17d7c5b8eba6a031466cc4873b2df8f563e0ee35aa375764b442ba2ace4dfa07ecf547b5cd15e7c1dcfab46bb147a5bb4cb605209d4d4af985311943fb335d537c7954fd2990be4d8d652613d13c4d72d1b1936bfd78abc3b753f2170d008a1c7498ef7bd069dbc15a7da64ba8003830f6f95dacbd22f0cae6e111cdc0c0b93eef622fb5c91f9e9e1c726e1b81c690da069733174bfa8c01abeb2b8f018e1d4f6f918453adbab62088ef84c6aaacb25c894a3e00efc846fc65c687f1fe4706e3981890cf4ddcd715cce1b059737665ec98c7202794341e47c45c72d26e645671648c763e27aa5cd9e941f6348ddac3e93c1def76c2bf1932ac04f872cf9b9328158ff97d8ab526c5f4ef40377128896bb882d30cb69615ae4935d611999c42224a7ba6b82e558537a5f658710e81b1b8d029aedfbcd1b72f3d3e891eb97043b4bea344916fe870e1a068d528a79fd3415929daaa26ebdabba9576352fa32b6e7720ed684b8e7b0491f63ae430c1c85de9110b6c7eef5553d99c056d7862790e9ff007da9688aaa04e012bbcdd65918874088c3d20e24a560ac3d422acada12009a8458b39d8c4b1119c629864b5c42b655abb40b0dd169da2fefe2381aa3f84e7ccdd2d293fdfe489016bf09c42683c4541a8306f148ce52bbf52c19be4e5e488bfbf58bd861e56f32373750d3d6edb06dc47bd565f25b798f290816f98b88cc68ef57ae5636b626534b8880b01542d2b86e64429d47ce96069b83673122908292e97904f2cbb1ed050618694c7f8bd25868be7b5a737be05886f7de1d2caf47fc40a16fb54fbfc45b48361212d1cea9ecc6a1b88e1b43563bbd959f8160ba6e2b0e9114d9d30ba321e489b8fa3c2c4505deb4a569573f9a2549121d18a40b0e37779300ea5929bc0b355f61de260e10a4cd16ffb28e0e5a20d404a44d561b4e6d08cb782064ad78df4f2cf34ec4322b643e19fe4a04a95a6a8dbfe4411ce0891a82d5f307c4b8b8ef9cc221311a502c130259386e47dd92bd613fb33da6836f0d53642cef864cc8ccf0e3ff07f34e043b2664ba5798427fb67d1a4ed65bd04b3888d09bde9ccc1bbbfaf55781eb9d105ddd2550062f32b4162d94de38937fbd9cd7f62f2a4a6ed94299c0c45c21a610619b0602a409bbfd377edb3c59f96b341de70f191f753b31d30fcd6b535a63968a928134d0623df9349832ae97e9c0011e138aa676b586c1099f0d247a185c206226478f63d8cd66f392332b0269c4a1893ffdad9cea2846fa3af4a7528ea649ccce3e36319395cf91cd94eb19d3b4f9e316044d07960d5f40e9c6a46fa19d6cfe587532559ce43b5e950b0f68b6f6f7ba61dcf70c26cb23f329c22e0d9408f22654ec53ede7856bcc3708cd4de22e8bcd35c5e5d43bed8d36c50f8a907203c56d4359360a946f60f55d307c13dde76dbc3e15c7587143644463f08cbb18dd9df1e8cfd6c0f9f93cfa548bc201a4fd6c83dd7b719dfeff0434830e5f4506f4e1568cd92425ccce6d366f562eabf76dd353aaf295d6e2dd8a09f87c657a49c7ed3f0d12619a58e686d7a1a6029286a1fc52e0389eb49199fe48b829660749d6833e6143b249c94a84d10d490a9fc1c83fad6f57944605f6e3c4d3c83c1a302b7d0218785a5fb28df49811eabee94e397eaef30e694abda3f7a4789e72ff6e359f1b3464af5c9bb9bacc27e3c0c50d79315b197ea77f8c114040df317f051b798df6886274ac9f3ad86eeafb06443764d601dd722d9248f1b53436d93801b863a8b476d757e53276957134dc41754da996f74f95506301b993b92f3a781fe24a37f823b82e77eb3cf03081f86a35753df0f0e5a015909fe192b19ae40cfa2c9c2d277205fc8adcf54234a069f46d2e63cbcfc6c0831b1515dfc9a9d97b3f764f42ecbcc2bb5689c96a13afc1fc525cc5f994d183771d39c088d9815321eb69d409086ac62e26a13a32c5dbb7bd8d2216a8d03ec5edeb30efb1e80b4849cd030ce7966fa3e27942b6c40dc670f36370e0f12e36fcb6fa2bc63a836e5b2544f80cd5dac2db114bd21a3d23e0e8e0e4c729f003e3c05a1cebb92b7c695cf5adaedc6c0baad34c606647a477c9b542b849498d9ee272c9dde1184df243e8d56a6c9fd3a67ead21ac937b4805ed49d73258df9da01d32fac6f582e7cbd882146481ba4ed7496317102d55ae66ce96eae578032043a0a136e29ec1200ac2d6663b9dfdceae9804c88e24295dea9711e1ab4c070a634e9422e2747109ba5321f3254e18ec13b8e5050a50258f72e5eb6e66a30bb5b38b7398a73d7b8c57c28d6914bc74a30cbb11949c68765f951c3961063205bb9ca0278d26bd69d8ad72e869a49c0900ac568e9e6bdd3213a94372869f18f027de90868e9412aa289a7ab7ee449e80f4c331e12fc9a05679d0a133673b87f43678c88a17edc56feca0323f041eb2ca104829efcbb95d531f682c0e55327739e44a6971e73a0b8a7191837399dcf7d9dd36758e5005e1324b38e6f1e0363d8eb4bd8936015f20658a54cf309a47d2f810c9d9f68aaa3a36cd249639fa6cb76b8ba3f13a70a4ee230decaec87ba63c83e99821bcfc3d698e425c015919b7e3da0315a7c2b257622bcf14cad519f77d36f421ad9ed71c294d9e27a154c2fdf488c03690343371cd177ad13f8541015d34023073222a90f0cd1870423765ec65a6753e023455a41ba6adbe911dd871106308f560167f0f0e84335ba620f3e6e17210cc60130bca541ff69e6ead35d05bb91ce3cab38cd9d86642f23c619e74499142902cd6b4e50ff39050bfa2ef430e97747ba91a8bcda49ac54eb911dd6459338e0bd66ccfc7af2233ac8349925dddaaedf2b48de893fbd8fe6eab78e4e3a72ad3377b35ff34504c45018056e25c09b81a313770e5ed14f62b21a563ff97ae433345300118adf83980e144dcecc22581d2f76c19aa4abaac954bc6652b1157578765f40cbf0763a27749358fd7096e72c896f1b30ef2435e5b345fa9f322b0d06bc72ef6695be5a4541252e864c3183aff5ccb19b0301191e24bca81a82b8346a0521100372de3464063373b6843b022c59000113ecdf7f874c35bc714ae0ef89be5bb9531c9b7b519747227a14713ecb581b03f67e2f39fb45e48708bedae0db3a161d5c3f2afba23b74581189c211931178ab4a1e1c0f4b7de91fd6686a1e654e9d6f763d26181aa78b38443dcfed083274c92c28d973283203daa2ca86d9af09b15010870dbebbe83f8c593314c9dad2b69dbf01c9d96ea388ce402c1a34cd48d9c3269f550c967db92a537709f2385247ccf7fd5912634fcd7ea2038dc0e62bdeb5c373619e4e715ecc2ee9988ec8959b9bc4cc60a8628a853eb64cd0ca8dea35a5ae2fc6567bad36abb7038114b2dcea5f3265b08d64a7a631346ee5592a0a0a73bd4b43508000b7c47cf8c27b792450d9c9db3f810e8b3b35f2812b7d64849066e3405fe5ae4686048c99e226bba1fe99a9ebdb7ea92e75388d02dfadb0b5832fbefab0367e6c1d8202d0a0f17f9cf5d1e48a37b0b5183a3365c6b8a492c54439eaff1cce827feb2bae89ca0665af1dfddb7f28497048b97ac440773caa77c34cab31fd7b7820f2d6f5e8279f0772a976e900c5e4b87a3ebde90af23ff4f9bc2759172ce9434235d1fa85e405f7fb439b27e1968516306f36ffd1d6c273d55ad0bc506b79db53eafaf9e2bf8e49acfe35e07fd16cf1f3871b1a96f9bb7b6e86c29cdd45d09c090676abd2ddd9b01fe03cbf0320e4a99c4cb4f7e6006aefa4294001c153d4ba30c6d601d47e940f7ac4a405923046db6f294347732868efc40a63179168b938d7a53468bfff0aa95c545def71c5a1dbfd7c5be6e7e39a3ba4fa0801a8b942e59e53f7b4c4213cd4a850c9a4ac10eaa925b16fca299e2968fe6ee80c8678e35fd77784e9ca2b7a2a5aef7c254072af3b10a0a767e5f08c1a64110109311584446ce040e0e265e45dd175ae994baeb278228f94b5e83625680b5ad15f4107d3b015e4adb2d825cb8c1f7583c08e5209cfa73da471b789b267e4c5b8f55009071c338e461fa76f3d291d14caf8f07ec6457b2875ee4e7dbf4cd9b30f0a4d1fe0b41095ca48ed9d7b28792a29acfa6cdf74f6534d02d69278aea5b0887b462aff1e8977c6f00cdffa0ec4399e86a5dbb1170d0b44083aed4f5caf979ed112381d6f57721ac394785996023610c076b5680ffa24207f074faa508f9a460d774ecc6cfada971d8158679ac99f917361b79bc3729d422af0ee52778eb20bd449b1c7fe6d1e8ab7067aba167ebe132ca4d8af3d2d709072daafaec2df4dfa223afab74a66b8d5911c12241bfa56473d49fd10b40eff2dd3a08aaf0480fb9ccd3ef501802eb341a117ce1d9fa1b2360be34aedd71cb729d6f1075cc34ec47a6680397f563890d0ad2160d11a999e488ed0f809c31eb884c2f0229b13db749b18d1857ea3e26c842eff477cd1600a9ded984fccf9c75bd9c74f4384ef0bdbfcf9983dc65f1ff149d90faec65fab1f54fcc4491a3ab3b5137c2c8c6e3d8b3133fcd5721d26e7dda515d4d78d062631faa3610452aced8bf56e6da16a5502af1161691e291d445e8977b2c1212f7aa28d6d40bbe229ecca45d42083b5b9e3b049ab24083428acff3e3e0a60749f10ad922b3df673d0a12396c5f53801c5c349ca6dc75723cb3cb516d5e3e117ab7c398ebc9e68f8324d125a5479e0078228b65b17b070a01e2b8d46b80cbe7d77f25a1df3c5e55b270b0a6c7236cc80a3ccba637d5c6ae9a882ecd5df9925f4915082c7e0e23f863e3579a60f5758747b37b2327fbe1b4421f56b576b78280fbf7f24b05c585861db0335a6fd343c063e5bae6b64d11763a934b9ba6cea3488ae818cdb691b316e965b629434ae25f45f5dfb49755bfed28da3f2aa88112a667c51f35d2fd8fad7fcda2a067ff7708be4c38de0f0914";
  const bytes = hexToBytes(hex);
  const reader = new ScorexReader(bytes);
  const inv = InvPayload.decode(reader);

  await t.step("check decoded", () => {
    assertEquals(inv.type, ObjectTypeId.BlockHeader);
    assertEquals(inv.ids.length, 400);

    assertEquals(
      inv.ids[0],
      "e7553c9a716bb3983ac8b0c21689a1f37ccdcde648a5be7677d673dae0d129f5",
    );
    assertEquals(
      inv.ids[100],
      "aba1f3048297ceac31825ce4a543c2e175126a374207d1c8272542a7700ba919",
    );
    assertEquals(
      inv.ids[200],
      "57c52e1142d9e57b80ae7b0ac8e1e0140b95f237c38ae0c8ee9238b7473ceac6",
    );
    assertEquals(
      inv.ids[300],
      "e870e1a068d528a79fd3415929daaa26ebdabba9576352fa32b6e7720ed684b8",
    );
    assertEquals(
      inv.ids[399],
      "ed28da3f2aa88112a667c51f35d2fd8fad7fcda2a067ff7708be4c38de0f0914",
    );
  });

  await t.step("re-encode", () => {
    const writer = new ScorexWriter();
    inv.encode(writer);

    assertEquals(bytesToHex(writer.buffer), hex);
  });
});

Deno.test("[protocol/inv] Inv throws for invalid object type id", () => {
  const reader = new ScorexReader(new Uint8Array([5]));

  assertThrows(
    () => InvPayload.decode(reader),
    Error,
    "invalid object type id",
  );
});

Deno.test("[protocol/inv] InvPayload.decode throws if item length less than 1", () => {
  const writer = new ScorexWriter();
  writer.putUint8(ObjectTypeId.BlockHeader);
  writer.putUint32(0);
  const reader = new ScorexReader(writer.buffer);

  assertThrows(
    () => InvPayload.decode(reader),
    RangeError,
    "less than 1 object ids provided",
  );
});

Deno.test("[protocol/inv] InvPayload.decode throws if item length exceeds limit", () => {
  const writer = new ScorexWriter();
  writer.putUint8(ObjectTypeId.BlockHeader);
  writer.putUint32(InvPayload.MAX_ITEMS + 5);
  const reader = new ScorexReader(writer.buffer);

  assertThrows(
    () => InvPayload.decode(reader),
    RangeError,
    "object ids provided exceeds limit",
  );
});
